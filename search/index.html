---
layout: null
title: Search Results
permalink: /search/
---

<h2>Search Results</h2>
<div id="search-query"></div>
<ul id="search-results"></ul>

<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  const resultsList = document.getElementById("search-results");
  const queryBox = document.getElementById("search-query");

  const params = new URLSearchParams(window.location.search);
  const query = params.get("q") || "";

  if (!query) {
    queryBox.innerHTML = "<p>No search query provided.</p>";
    return;
  }

  queryBox.innerHTML = `<p>Showing results for: <strong>${query}</strong></p>`;

  fetch("/posts.json")
    .then(res => res.json())
    .then(posts => {
      const fuse = new Fuse(posts, {
        keys: ["title", "excerpt", "categories"],
        threshold: 0.4,
        ignoreLocation: true,
        findAllMatches: true,
      });

      // split query jadi kata-kata
      const terms = query.toLowerCase().split(/\s+/).filter(Boolean);

      // hasil dari Fuse
      const fuseResults = fuse.search(query).map(r => r.item);

      // filter supaya semua terms ada
      const filtered = fuseResults.filter(post => {
        const text = (post.title + " " + post.excerpt + " " + post.categories.join(" ")).toLowerCase();
        return terms.every(t => text.includes(t));
      });

      if (filtered.length === 0) {
        resultsList.innerHTML = "<li>No results found.</li>";
        return;
      }

      filtered.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `
          <a href="${item.url}">
            <img src="${item.image}" alt="${item.title}" 
                 style="width:60px;height:auto;margin-right:10px;vertical-align:middle;">
            <span>${item.title}</span>
          </a>
          <p>${item.excerpt}</p>
        `;
        resultsList.appendChild(li);
      });
    });
});
</script>
