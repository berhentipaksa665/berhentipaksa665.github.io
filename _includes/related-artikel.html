<hr />
<h3>More Video</h3>
<section id="random-posts" class="post-grid"></section>

<div style="text-align:center; margin:20px;">
  <button id="load-more" style="
    background:#222;
    color:#fff;
    border:none;
    padding:10px 20px;
    border-radius:6px;
    cursor:pointer;
    font-size:15px;
    transition:background 0.3s ease;
  ">Load More Posts</button>
</div>

<style>
.post-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  padding: 10px;
}

@media (min-width: 600px) {
  .post-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 1000px) {
  .post-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

/* anchor harus relatif supaya anak absolute positioned bekerja */
.post-grid a {
  position: relative;
  display: block;
  overflow: hidden;
  border-radius: 10px;
  background: #f0f0f0;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  min-height: 0; /* pastikan tidak collapse */
}

.post-grid a:hover {
  transform: scale(1.03);
  box-shadow: 0 3px 12px rgba(0,0,0,0.1);
}

/* Skeleton placeholder dengan aspect-ratio 16:9 */
.skeleton {
  position: relative;
  background: linear-gradient(90deg, #f0f0f0 25%, #e6e6e6 37%, #f0f0f0 63%);
  background-size: 400% 100%;
  animation: skeleton-loading 1.4s ease infinite;
  padding-top: 56.25%; /* 16:9 ratio */
  border-radius: 10px;
}

/* Animasi skeleton */
@keyframes skeleton-loading {
  0% { background-position: 100% 0; }
  100% { background-position: -100% 0; }
}

/* Gambar di-overlay absolute */
.post-grid img {
  position: absolute;
  top: 0; left: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.45s ease;
  border-radius: 10px;
}

/* Setelah terload */
.post-grid img.loaded {
  opacity: 1;
}

/* Play icon (transparan di tengah) */
.play-icon {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 56px;
  height: 56px;
  border-radius: 50%;
  background: rgba(0,0,0,0.35); /* transparan */
  display: flex;
  align-items: center;
  justify-content: center;
  pointer-events: none;
}

/* triangle inside */
.play-icon::after {
  content: "";
  display: block;
  width: 0;
  height: 0;
  border-left: 14px solid rgba(255,255,255,0.95);
  border-top: 9px solid transparent;
  border-bottom: 9px solid transparent;
  margin-left: 4px;
}

.post-grid a:hover .play-icon {
  background: rgba(0,0,0,0.55);
}

#load-more:hover {
  background:#444;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  let allPosts = [];
  let currentIndex = 0;
  const batchSize = 12;
  const container = document.getElementById('random-posts');
  const button = document.getElementById('load-more');

  if (!container) return console.error('Container #random-posts tidak ditemukan.');

  // Global IntersectionObserver (dipakai ulang)
  const imgObserver = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (!entry.isIntersecting) return;
      const img = entry.target;
      const dataSrc = img.getAttribute('data-src');
      if (dataSrc) {
        // set src dari data-src
        img.src = dataSrc;
        // ketika load selesai, tambahkan class .loaded dan hapus skeleton jika ada
        img.addEventListener('load', () => {
          img.classList.add('loaded');
          // skeleton diasumsikan adalah previousElementSibling; cek aman
          const possibleSkeleton = img.previousElementSibling;
          if (possibleSkeleton && possibleSkeleton.classList && possibleSkeleton.classList.contains('skeleton')) {
            possibleSkeleton.remove();
          }
        }, { once: true });

        img.removeAttribute('data-src');
      }
      obs.unobserve(img);
    });
  }, { rootMargin: '120px 0px', threshold: 0.01 });

  // Fetch posts.json dan render batch pertama
  fetch('/posts.json')
    .then(res => {
      if (!res.ok) throw new Error('HTTP ' + res.status);
      return res.json();
    })
    .then(data => {
      if (!Array.isArray(data)) throw new Error('posts.json bukan array');
      allPosts = data.sort(() => Math.random() - 0.5);
      renderPosts();
    })
    .catch(err => {
      console.error('Gagal memuat posts.json:', err);
      container.innerText = 'Gagal memuat data postingan.';
    });

  // Render next batch
  function renderPosts() {
    if (!allPosts || allPosts.length === 0) return;
    const nextBatch = allPosts.slice(currentIndex, currentIndex + batchSize);

    const frag = document.createDocumentFragment();
    nextBatch.forEach(post => {
      // buat anchor
      const a = document.createElement('a');
      a.href = post.url || '#';
      a.setAttribute('aria-label', post.title || 'video');

      // skeleton placeholder (menyediakan aspect ratio)
      const skel = document.createElement('div');
      skel.className = 'skeleton';

      // img dengan data-src (belum dimuat)
      const img = document.createElement('img');
      img.setAttribute('data-src', post.image || '');
      img.alt = post.title ? post.title.replace(/"/g, '') : '';

      // play icon
      const play = document.createElement('div');
      play.className = 'play-icon';
      // susun: skeleton dulu, lalu img, lalu play icon
      a.appendChild(skel);
      a.appendChild(img);
      a.appendChild(play);

      frag.appendChild(a);

      // observe image untuk lazy load
      if (img.getAttribute('data-src')) {
        imgObserver.observe(img);
      } else {
        // jika tidak ada data-src, langsung tandai loaded agar tampil
        img.classList.add('loaded');
        skel.remove();
      }
    });

    container.appendChild(frag);

    currentIndex += batchSize;
    if (currentIndex >= allPosts.length && button) {
      button.style.display = 'none';
    }
  }

  // tombol load more
  if (button) {
    button.addEventListener('click', () => {
      renderPosts();
    });
  }
});
</script>

<!-- awal photo gallery -->
<hr />
<h3>Photo Artis Seksi</h3>
<style>
.masonryuGallery2-container {
  column-count: 3;
  column-gap: 0;
}
@media (min-width: 600px) {
  .masonryuGallery2-container { column-count: 4; }
}
@media (min-width: 1000px) {
  .masonryuGallery2-container { column-count: 4; }
}
.masonryuGallery2-container .masonryu-item {
  break-inside: avoid;
  margin: 0;
  padding: 0;
}
.masonryuGallery2-container a { display: block; width: 100%; }
.masonryuGallery2-container img {
  width: 100%;
  height: auto;
  display: block;
  object-fit: cover;
}
</style>

<div class="masonryuGallery2-container" id="masonryuGallery2-feed"></div>

<script>
function showFeed(json) {
  const entries = json.feed.entry || [];
  if (entries.length === 0) return;

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
  }

  shuffle(entries);
  const container = document.getElementById("masonryuGallery2-feed");

  function getPostUrl(entry) {
    return entry.link.find(l => l.rel === "alternate").href;
  }

  function extractImage(entry) {
    const content = entry.content?.$t || '';
    const imgMatch = content.match(/<img[^>]+src="([^">]+)"/);
    return imgMatch ? imgMatch[1] : "https://via.placeholder.com/300x200?text=No+Image";
  }

  let html = '';
  entries.slice(0, 1000).forEach(entry => {
    const img = extractImage(entry);
    const url = getPostUrl(entry);
    const title = entry.title.$t;
    html += `
      <div class="masonryu-item">
        <a href="${url}" title="${title}">
          <img src="${img}" alt="${title}">
        </a>
      </div>`;
  });

  container.innerHTML = html;
}

// JSONP version: Blogger feed + callback
document.write('<script src="https://www.raiska.my.id/feeds/posts/default?alt=json-in-script&callback=showFeed&max-results=9999"></' + 'script>');
</script>
<!-- akhir photo gallery -->
	<br />
