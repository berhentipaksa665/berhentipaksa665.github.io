<section class="recent-posts">          
  <div id="recent-posts-container" class="grid"></div>          
  <div id="pagination" class="pagination"></div>          
</section>          

<style>
/* ðŸ”¹ Grid responsif */
#recent-posts-container {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

@media (min-width: 768px) {
  #recent-posts-container {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 1200px) {
  #recent-posts-container {
    grid-template-columns: repeat(4, 1fr);
  }
}

.post-card {
  position: relative;
  overflow: hidden;
  border-radius: 10px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  background: #000;
}

.post-card img {
  display: block;
  width: 100%;
  height: auto;
  transition: transform .3s ease;
}

.post-card:hover img {
  transform: scale(1.05);
}

/* ðŸ”¹ Ikon play transparan */
.post-card::after {
  content: 'â–¶';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 3rem;
  color: rgba(255,255,255,0.7);
  text-shadow: 0 0 8px rgba(0,0,0,0.4);
  pointer-events: none;
}

/* ðŸ”¹ Judul */
.post-card h3 {
  font-size: 1rem;
  margin: 0.5rem;
  text-align: center;
  color: #fff;
}

/* ðŸ”¹ Paginasi */
.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: .3rem;
  flex-wrap: wrap;
  margin-top: 1.5rem;
}

.pagination button,
.pagination a {
  padding: .4rem .7rem;
  border: 1px solid #ccc;
  background: #f5f5f5;
  cursor: pointer;
  border-radius: 4px;
  font-size: .9rem;
  text-decoration: none;
  color: #333;
}

.pagination button[disabled],
.pagination a[disabled] {
  opacity: 0.5;
  cursor: default;
}

.pagination button.active,
.pagination a.active {
  background: #333;
  color: #fff;
  font-weight: bold;
}
</style>

<script>    
function getCategoryCandidates(hostname) {          
  const parts = hostname.split('.');          
  if (parts.length < 2) return { sub: null, domain: null };          
  const maybeDomainIndex = parts.length - 3;          
  const domain = (maybeDomainIndex >= 0) ? parts[maybeDomainIndex] : parts[0];          
  const subLabels = (maybeDomainIndex > 0) ? parts.slice(0, maybeDomainIndex) : [];          
  const rawSub = subLabels.length ? subLabels.join('.') : null;          
  const normalize = s => String(s || '').replace(/[-.]+/g, ' ').replace(/\s+/g, ' ').trim().toLowerCase();          
  return { sub: rawSub ? normalize(rawSub) : null, domain: domain ? normalize(domain) : null };          
}          
    
// ðŸ”¹ Baca nomor halaman dari URL (misalnya ?page1, ?page2)
const urlParams = new URLSearchParams(window.location.search);
let pageParam = 1;
for (const [key] of urlParams) {
  if (key.startsWith('page')) {
    pageParam = parseInt(key.replace('page', '')) || 1;
    break;
  }
}
const initialPage = pageParam;

const { sub: subCategory, domain: domainCategory } = getCategoryCandidates(window.location.hostname);          
const POSTS_PER_PAGE = 6;          
let currentPage = initialPage;          
let filteredPosts = [];          
    
fetch('/posts.json')          
  .then(res => {          
    if (!res.ok) throw new Error('Failed to load posts.json');          
    return res.json();          
  })          
  .then(posts => {          
    const normalize = s => String(s || '').replace(/[-.]+/g, ' ').replace(/\s+/g, ' ').trim().toLowerCase();          
    if (!Array.isArray(posts) || posts.length === 0) return renderNoPosts();          
    
    if (subCategory) {          
      filteredPosts = posts.filter(p => Array.isArray(p.categories) && p.categories.some(c => normalize(c) === subCategory));          
    }          
    if (filteredPosts.length === 0 && domainCategory) {          
      filteredPosts = posts.filter(p => Array.isArray(p.categories) && p.categories.some(c => normalize(c) === domainCategory));          
    }          
    if (filteredPosts.length === 0) { filteredPosts = posts; }          
    
    filteredPosts.sort((a, b) => new Date(b.date) - new Date(a.date));          
    renderPosts();          
  })          
  .catch(err => { console.error('Error loading posts:', err); renderNoPosts(); });          
    
function renderPosts() {          
  const container = document.getElementById('recent-posts-container');          
  const pagination = document.getElementById('pagination');          
  container.innerHTML = '';          
  pagination.innerHTML = '';          
    
  const start = (currentPage - 1) * POSTS_PER_PAGE;          
  const end = start + POSTS_PER_PAGE;          
  const pagePosts = filteredPosts.slice(start, end);          
    
  pagePosts.forEach(post => {          
    const card = document.createElement('div');          
    card.className = 'post-card';          
    const linkImg = document.createElement('a');          
    linkImg.href = post.url || '#';          
    const img = document.createElement('img');          
    img.loading = 'lazy';          
    img.alt = post.title || '';          
    img.src = post.image || '/assets/default-thumb.jpg';          
    linkImg.appendChild(img);          
    card.appendChild(linkImg);          
    const h3 = document.createElement('h3');          
    const linkTitle = document.createElement('a');          
    linkTitle.href = post.url || '#';          
    linkTitle.textContent = post.title || '(no title)';          
    h3.appendChild(linkTitle);          
    card.appendChild(h3);          
    container.appendChild(card);          
  });          
    
  const totalPages = Math.ceil(filteredPosts.length / POSTS_PER_PAGE);          
  if (totalPages > 1) {          
    addNavButton('First', 1, currentPage === 1);
    addNavButton('Prev', currentPage - 1, currentPage === 1);
    
    const maxVisible = 5;          
    let startPage = Math.max(1, currentPage - 2);          
    let endPage = Math.min(totalPages, currentPage + 2);          
    if (currentPage <= 3) endPage = Math.min(totalPages, maxVisible);          
    else if (currentPage >= totalPages - 2) startPage = Math.max(1, totalPages - maxVisible + 1);          
    
    if (startPage > 1) { addPageButton(1); if (startPage > 2) addEllipsis(); }          
    for (let i = startPage; i <= endPage; i++) addPageButton(i);          
    if (endPage < totalPages) { if (endPage < totalPages - 1) addEllipsis(); addPageButton(totalPages); }          
    
    addNavButton('Next', currentPage + 1, currentPage === totalPages);
    addNavButton('Last', totalPages, currentPage === totalPages);
  }          
}          
    
function addNavButton(text, page, disabled) {
  const pagination = document.getElementById('pagination');
  const link = document.createElement('a');
  link.textContent = text;
  if (disabled) link.setAttribute('disabled', true);
  else link.href = `/?page${page}`;
  if (!disabled) link.onclick = e => { e.preventDefault(); changePage(page); };
  pagination.appendChild(link);
}

function changePage(page) {    
  currentPage = page;    
  renderPosts();    
  const newUrl = `${window.location.pathname}?page${String(page).padStart(1, '0')}`;    
  history.pushState({}, '', newUrl);    
}    
    
function addPageButton(page) {          
  const pagination = document.getElementById('pagination');          
  const link = document.createElement('a');          
  link.textContent = page;          
  link.href = `/?page${page}`;          
  if (page === currentPage) link.classList.add('active');          
  link.onclick = e => { e.preventDefault(); changePage(page); };          
  pagination.appendChild(link);          
}          
    
function addEllipsis() {          
  const pagination = document.getElementById('pagination');          
  const span = document.createElement('span');          
  span.textContent = 'â€¦';          
  pagination.appendChild(span);          
}          
    
function renderNoPosts() {          
  document.getElementById('recent-posts-container').innerHTML = '<p>No posts found.</p>';          
  document.getElementById('pagination').innerHTML = '';          
}          
</script>

