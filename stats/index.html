<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard GA4 Sederhana</title>
<style>
body { font-family: system-ui, sans-serif; margin: 2rem; background: #fafafa; }
h2 { margin-bottom: 1rem; }
input, select { padding: .4rem; margin: .3rem; }
table { border-collapse: collapse; width: 100%; margin-top: 1rem; background: white; }
th, td { border: 1px solid #ddd; padding: .6rem; text-align: left; }
th { background: #f2f2f2; }
</style>
</head>
<body>

<h2>Statistik GA4</h2>

<div>
  <label>Dari: <input type="date" id="startDate"></label>
  <label>Sampai: <input type="date" id="endDate"></label>
  <button id="loadData">Tampilkan</button>
</div>

<table id="resultTable">
  <thead>
    <tr>
      <th>Tanggal</th>
      <th>Host</th>
      <th>Path</th>
      <th>Referrer</th>
      <th>Jumlah Visitor</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script src="https://apis.google.com/js/api.js"></script>
<script>
const CLIENT_ID = "682001383766-fsm8agved3m3qrmflb9qp15pkdvmv83c.apps.googleusercontent.com"; // <== ganti di sini
const PROPERTY_ID = "11825003426"; // ID aliran data kamu

function init() {
  gapi.load("client:auth2", () => {
    gapi.auth2.init({ client_id: CLIENT_ID });
  });
}

async function authorizeAndLoadData() {
  await gapi.auth2.getAuthInstance().signIn();
  await gapi.client.load("https://analyticsdata.googleapis.com/$discovery/rest?version=v1beta");
  await getReport();
}

async function getReport() {
  const startDate = document.getElementById("startDate").value;
  const endDate = document.getElementById("endDate").value;

  const response = await gapi.client.analyticsdata.properties.runReport({
    property: `properties/${PROPERTY_ID}`,
    resource: {
      dateRanges: [{ startDate, endDate }],
      dimensions: [
        { name: "date" },
        { name: "hostName" },
        { name: "pagePath" },
        { name: "pageReferrer" }
      ],
      metrics: [{ name: "activeUsers" }],
    },
  });

  const rows = response.result.rows || [];
  const tbody = document.querySelector("#resultTable tbody");
  tbody.innerHTML = "";

  rows.forEach(r => {
    const tr = document.createElement("tr");
    r.dimensionValues.forEach((d, i) => {
      const td = document.createElement("td");
      td.textContent = d.value;
      tr.appendChild(td);
    });
    const metric = document.createElement("td");
    metric.textContent = r.metricValues[0].value;
    tr.appendChild(metric);
    tbody.appendChild(tr);
  });
}

document.getElementById("loadData").addEventListener("click", authorizeAndLoadData);
window.onload = init;
</script>

</body>
</html>
