---
layout: null
permalink: /x/2/
---

<div id="archive"></div>
<div id="pagination" style="margin-top:20px;"></div>

<script>
(async () => {

  const ITEMS_PER_PAGE = 10;

  // -------------------------------------------------------
  // 1. Fetch JSON
  // -------------------------------------------------------
  const res = await fetch("/posts.json");
  const posts = await res.json();

  // -------------------------------------------------------
  // 2. Group by month/day → folder structure
  // -------------------------------------------------------
  const groups = {};

  posts.forEach(post => {
    const d = new Date(post.date || post.url.substring(1, 11));
    const month = String(d.getMonth() + 1).padStart(2, "0");
    const day   = String(d.getDate()).padStart(2, "0");

    const key = `${month}/${day}`;

    if (!groups[key]) groups[key] = [];
    groups[key].push(post);
  });

  const keys = Object.keys(groups).sort().reverse();

  // -------------------------------------------------------
  // 3. Flatten into single list for pagination
  // -------------------------------------------------------
  const flat = [];

  keys.forEach(key => {
    groups[key].forEach(p => {
      flat.push({ folder: key, post: p });
    });
  });

  // -------------------------------------------------------
  // 4. Auto Pagination
  // -------------------------------------------------------
  const params = new URLSearchParams(window.location.search);
  let pageStr = params.get("page") || "01";

  // remove "page" word → convert to number
  pageStr = pageStr.replace("page", "");
  let page = parseInt(pageStr, 10);
  if (isNaN(page) || page < 1) page = 1;

  const totalItems = flat.length;
  const totalPages = Math.ceil(totalItems / ITEMS_PER_PAGE);

  if (page > totalPages) page = totalPages;

  const start = (page - 1) * ITEMS_PER_PAGE;
  const end   = start + ITEMS_PER_PAGE;

  const currentItems = flat.slice(start, end);

  // -------------------------------------------------------
  // 5. Render Output
  // -------------------------------------------------------
  const container = document.getElementById("archive");
  container.innerHTML = "";

  let lastFolder = "";

  currentItems.forEach((item, idx) => {
    const folder = item.folder;
    const post = item.post;

    if (folder !== lastFolder) {
      container.innerHTML += `
        <div class="folder-title" style="font-weight:600;margin-top:12px;">
          <svg viewBox="0 0 24 24" width="18" style="vertical-align:middle;fill:#008080;">
            <path d="M3 5h7l2 3h9v11H3z"></path>
          </svg>
          ${folder}
        </div>
      `;
      lastFolder = folder;
    }

    const num = String(idx + 1 + start).padStart(2, "0");

    const safeTitle = post.title
      .replace(/[\/\\\?\:\*\"\<\>\|]/g, "")
      .replace(/-/g, " ")
      .trim()
      .toLowerCase();

    const filename = `video ${num} ${safeTitle}.mp4`;

    container.innerHTML += `
      <div class="file-item" style="margin-left:25px;margin-bottom:6px;">
        <a href="${post.url}" style="text-decoration:none;color:inherit;">
          ▶ ${filename}
        </a>
      </div>
    `;
  });

  // -------------------------------------------------------
  // 6. Render Pagination Automatically
  // -------------------------------------------------------
  const pag = document.getElementById("pagination");

  let html = "";

  if (page > 1) {
    const prev = String(page - 1).padStart(2, "0");
    html += `<a href="?page${prev}" style="margin-right:10px;">← Prev</a>`;
  }

  for (let i = 1; i <= totalPages; i++) {
    const p = String(i).padStart(2, "0");
    html += `<a href="?page${p}" style="margin-right:8px;${i===page?'font-weight:700;':''}">Page ${p}</a>`;
  }

  if (page < totalPages) {
    const next = String(page + 1).padStart(2, "0");
    html += `<a href="?page${next}" style="margin-left:10px;">Next →</a>`;
  }

  pag.innerHTML = html;

})();
</script>

