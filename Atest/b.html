<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peta Situs</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; background: #fafafa; color: #222; }
  h2, h3, h4, h5, h6 { margin-top: 1.5rem; color: #333; text-transform: capitalize; }
  ul { list-style: disc; margin-left: 1.5rem; }
  li { margin: 0.4rem 0; }
  a { color: #0070f3; text-decoration: none; }
  a:hover { text-decoration: underline; }
  .loading { color: #777; font-style: italic; }
</style>
</head>
<body>
  <h2>Peta Situs</h2>
  <p class="loading">Memuat daftar halaman...</p>
  <div id="sitemap-container"></div>

  <script>
  async function loadSitemap() {
    const container = document.getElementById('sitemap-container');
    const loading = document.querySelector('.loading');

    try {
      const res = await fetch(`${location.origin}/sitemap.xml`);
      if (!res.ok) throw new Error("Gagal mengambil sitemap.xml");

      const xml = new DOMParser().parseFromString(await res.text(), "application/xml");
      const urls = xml.querySelectorAll("url > loc");
      loading.remove();

      if (!urls.length) {
        container.innerHTML = "<p>Tidak ada URL ditemukan.</p>";
        return;
      }

      // Simpan struktur hirarki
      const tree = {};

      urls.forEach(node => {
        let path = node.textContent.trim().replace(/^https?:\/\/[^/]+/i, '');
        if (path.endsWith('/') && path !== '/') path = path.slice(0, -1);

        // Pisahkan berdasarkan folder
        const parts = path.split('/').filter(Boolean);
        let current = tree;
        parts.forEach((part, i) => {
          const clean = part.replace(/\.html$/, '');
          if (!current[clean]) current[clean] = { _path: '', _children: {} };
          if (i === parts.length - 1) current[clean]._path = path; // simpan path untuk link
          current = current[clean]._children;
        });
      });

      function buildList(obj, level = 2) {
        const ul = document.createElement('ul');
        Object.keys(obj).sort().forEach(key => {
          const { _path, _children } = obj[key];
          const li = document.createElement('li');
          const textReadable = key.replace(/-/g, ' ');

          // Jika punya anak, tambahkan heading sesuai level
          if (Object.keys(_children).length) {
            const heading = document.createElement(`h${Math.min(level, 6)}`);
            heading.textContent = textReadable;
            li.appendChild(heading);
            li.appendChild(buildList(_children, level + 1));
          } else if (_path) {
            // Item terakhir, buat link
            const a = document.createElement('a');
            a.href = _path;
            a.textContent = textReadable;
            li.appendChild(a);
          }

          ul.appendChild(li);
        });
        return ul;
      }

      const structure = buildList(tree, 2);
      container.appendChild(structure);

    } catch (err) {
      loading.textContent = "Gagal memuat sitemap.";
      console.error(err);
    }
  }

  loadSitemap();
  </script>
</body>
</html>
