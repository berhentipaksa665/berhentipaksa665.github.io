<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Peta Situs</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; background: #fff; color: #222; line-height: 1.6; }
  h2 { font-size: 1.3rem; margin-top: 2rem; margin-bottom: .5rem; text-transform: capitalize; }
  ul { list-style: disc; margin-left: 1.5rem; padding-left: 0; }
  li { margin: 0.3rem 0; }
  a { color: #0070f3; text-decoration: none; }
  a:hover { text-decoration: underline; }
  .loading { color: #777; font-style: italic; }
</style>
</head>
<body>
  <h1>Peta Situs</h1>
  <p class="loading">Memuat daftar halaman...</p>
  <div id="sitemap-container"></div>

  <script>
  async function loadSitemap() {
    const container = document.getElementById('sitemap-container');
    const loading = document.querySelector('.loading');

    try {
      const sitemapURL = `${location.origin}/sitemap.xml`;
      const res = await fetch(sitemapURL);
      if (!res.ok) throw new Error("Gagal mengambil sitemap.xml");

      const xmlText = await res.text();
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, "application/xml");

      const urls = xml.querySelectorAll("url > loc");
      loading.remove();

      if (!urls.length) {
        container.innerHTML = "<p>Tidak ada URL ditemukan.</p>";
        return;
      }

      // Grup folder
      const groups = {};

      urls.forEach(node => {
        let path = node.textContent.trim();
        path = path.replace(/^https?:\/\/[^/]+/i, ''); // hapus domain

        if (path.endsWith('/') && path !== '/') path = path.slice(0, -1);

        // Pisahkan folder dan nama file
        const parts = path.replace(/^\/|\.html$/g, '').split('/');
        const folder = parts.length > 1 ? parts[0] : '(root)';
        const file = parts.length > 1 ? parts[1] : parts[0];

        if (!groups[folder]) groups[folder] = [];
        groups[folder].push({ file, path });
      });

      // Tampilkan hasil
      const sortedFolders = Object.keys(groups).sort();
      sortedFolders.forEach(folder => {
        const section = document.createElement('section');

        // Jika folder bukan root, tampilkan judul H2
        if (folder !== '(root)') {
          const h2 = document.createElement('h2');
          h2.textContent = folder.replace(/-/g, ' ');
          section.appendChild(h2);
        }

        const ul = document.createElement('ul');
        groups[folder]
          .sort((a, b) => a.file.localeCompare(b.file))
          .forEach(({ file, path }) => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = path;
            a.textContent = file.replace(/-/g, ' ');
            li.appendChild(a);
            ul.appendChild(li);
          });

        section.appendChild(ul);
        container.appendChild(section);
      });

    } catch (e) {
      loading.textContent = "Gagal memuat sitemap.";
      console.error(e);
    }
  }

  loadSitemap();
  </script>
</body>
</html>
