<script>
(async () => {
  const host = location.hostname.toLowerCase().trim();
  const parts = host.split(".");
  let filePath = "";

  // Ambil nama domain utama (misal: domain.my.id â†’ domain)
  function getMainDomain(p) {
    if (p.length >= 3) return p[p.length - 3];
    if (p.length === 2) return p[0];
    return "unknown";
  }

  const main = getMainDomain(parts);

  // Tentukan path index berdasarkan subdomain
  if (parts.length > 2) {
    const sub = parts[0];
    filePath = (sub === "www")
      ? `/index/www.${main}.index.html`
      : `/index/${sub}.index.html`;
  } else {
    filePath = `/index/${main}.index.html`;
  }

  async function loadHTML(path) {
    const res = await fetch(path, { cache: "no-store" });
    if (!res.ok) throw new Error(res.statusText);
    const html = await res.text();
    document.open();
    document.write(html);
    document.close();
  }

  // Proses dengan fallback
  try {
    await loadHTML(filePath);
  } catch (err1) {
    console.warn(`Gagal memuat: ${filePath}`, err1);
    try {
      const fallback = "/index/fallback.index.html";
      console.warn(`Memuat fallback: ${fallback}`);
      await loadHTML(fallback);
    } catch (err2) {
      console.error("Fallback juga gagal:", err2);
      document.body.innerHTML = `
        <main style="padding:2rem;text-align:center;font-family:sans-serif;">
          <h2>Halaman tidak ditemukan</h2>
          <p>File <code>${filePath}</code> dan <code>/index/fallback.index.html</code> tidak tersedia.</p>
        </main>`;
    }
  }
})();
</script>
