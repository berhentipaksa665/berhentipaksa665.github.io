<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dynamic Domain Index</title>
<style>
  body { font-family: sans-serif; margin: 0; padding: 0; }
</style>
</head>
<body>
  <div id="app">Loading...</div>

  <script>
  (async () => {
    const host = window.location.hostname;
    const parts = host.split(".");
    let filePath = "";

    // 🔹 Tentukan path file berdasarkan domain/subdomain
    if (parts.length > 2) {
      const sub = parts[0];
      const domainMain = parts.slice(-3, -2)[0];
      if (sub === "www") {
        filePath = `/index/www.${domainMain}.index.html`;
      } else {
        filePath = `/index/${sub}.index.html`;
      }
    } else {
      const domainMain = parts[0];
      filePath = `/index/${domainMain}.index.html`;
    }

    // 🔹 Fungsi aman untuk memuat halaman
    async function safeLoad(path) {
      try {
        const res = await fetch(path);
        const html = await res.text();

        // deteksi jika file tidak ada tapi server balas 200 dengan isi error
        if (!res.ok || html.trim().length < 50 || html.includes("404") && html.includes("<html")) {
          throw new Error("invalid file or 404 page");
        }

        document.open();
        document.write(html);
        document.close();
        return true;
      } catch (err) {
        console.warn(`❌ Gagal memuat ${path}:`, err.message);
        return false;
      }
    }

    // 🔹 Urutan fallback
    const ok = await safeLoad(filePath);
    if (!ok) {
      const fallbackOk = await safeLoad("/index/fallback.index.html");
      if (!fallbackOk) {
        document.getElementById("app").textContent = "Memuat halaman utama...";
        console.warn("⚠️ Semua fallback gagal, tampilkan index.html utama.");
      }
    }
  })();
  </script>
</body>
</html>
